# pre test file
---
- name: pre | install dependencies
  apt:
    name:
      - openssl
    state: "{{ apt_install_state | default('latest') }}"
    update_cache: true
    cache_valid_time: "{{ apt_update_cache_valid_time | default(3600) }}"

- name: pre | generate key
  command: >
    openssl genrsa -out {{ playbook_dir }}/../files/ca-oefenweb-nl.key 2048;
  args:
    creates: "{{ playbook_dir }}/../files/ca-oefenweb-nl.key"
  become: false

- name: pre | generate crt
  shell: >
    openssl req \
      -subj '/C=NL/ST=NH/L=Amsterdam/O=Oefenweb.nl B.V./OU=Systeembeheer/CN=oefenweb.nl/emailAddress=root@oefenweb.nl/' \
      -x509 -new -nodes \
      -key {{ playbook_dir }}/../files/ca-oefenweb-nl.key \
      -days 1 \
      -out {{ playbook_dir }}/../files/ca-oefenweb-nl.crt \
    ;
  args:
    creates: "{{ playbook_dir }}/../files/ca-oefenweb-nl.crt"
  become: false
